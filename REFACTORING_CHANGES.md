# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–∫–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

## üóÇÔ∏è –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ú–æ–¥–µ–ª–∏ (models/)
–ú–æ–¥–µ–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:

```
src/models/
‚îú‚îÄ‚îÄ __init__.py          # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ base.py             # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å SQLAlchemy
‚îú‚îÄ‚îÄ lesson.py           # –ú–æ–¥–µ–ª—å —É—Ä–æ–∫–∞
‚îú‚îÄ‚îÄ transcript.py       # –ú–æ–¥–µ–ª—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
‚îî‚îÄ‚îÄ materials.py        # –ú–æ–¥–µ–ª—å —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
```

### –§–∏–ª—å—Ç—Ä—ã (filters/)
–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≥–∏–±–∫–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏:

```
src/filters/
‚îú‚îÄ‚îÄ __init__.py          # –≠–∫—Å–ø–æ—Ä—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îî‚îÄ‚îÄ lesson_filters.py    # –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —É—Ä–æ–∫–æ–≤
```

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (controllers/)
–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã:

```
src/controllers/
‚îú‚îÄ‚îÄ __init__.py          # –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ lesson_controller.py # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —É—Ä–æ–∫–æ–≤
```

## üöÄ –ù–æ–≤—ã–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. GET /lessons - –°–ø–∏—Å–æ–∫ —É—Ä–æ–∫–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (page, page_size)
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª—é–±–æ–º—É –ø–æ–ª—é (order_by, order_direction)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–ª–∏—á–∏—é —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
GET /lessons?page=1&page_size=10&status=completed&lesson_type=chinese&has_materials=true
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "items": [...],
  "meta": {
    "page": 1,
    "page_size": 10,
    "total_items": 25,
    "total_pages": 3,
    "has_next": true,
    "has_previous": false
  }
}
```

### 2. GET /lessons/statistics - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Ä–æ–∫–æ–≤

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–∫–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º
- –°—á–µ—Ç—á–∏–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "total_lessons": 50,
  "status_distribution": {
    "completed": 35,
    "processing": 5,
    "recording": 3,
    "failed": 2
  },
  "type_distribution": {
    "chinese": 30,
    "english": 20
  },
  "with_transcript": 40,
  "with_materials": 35
}
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

### –°—Ç–∞—Ç—É—Å –∏ —Ç–∏–ø
- `status` - –û–¥–∏–Ω —Å—Ç–∞—Ç—É—Å
- `statuses` - –ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å–æ–≤
- `lesson_type` - –û–¥–∏–Ω —Ç–∏–ø —É—Ä–æ–∫–∞
- `lesson_types` - –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `student_id` - ID —Å—Ç—É–¥–µ–Ω—Ç–∞
- `teacher_id` - ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

### –î–∞—Ç—ã
- `created_after` / `created_before` - –ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `started_after` / `started_before` - –ü–æ –¥–∞—Ç–µ –Ω–∞—á–∞–ª–∞

### –ü–æ–∏—Å–∫ –∏ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `search` - –ü–æ–∏—Å–∫ –ø–æ URL –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º
- `has_transcript` - –ï—Å—Ç—å –ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
- `has_materials` - –ï—Å—Ç—å –ª–∏ —É—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ö–ª–∞—Å—Å `LessonFilter` –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫ –∑–∞–ø—Ä–æ—Å–∞–º
- Pydantic –º–æ–¥–µ–ª—å `LessonFilterParams` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (OR, LIKE, EXISTS)

### 2. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- –ö–ª–∞—Å—Å `LessonController` —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
- –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- Eager loading –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö
- –ù–æ–≤—ã–µ Pydantic —Å—Ö–µ–º—ã –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- –ì–µ–Ω–µ—Ä–∏–∫ `PaginatedResponse` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Enum'—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ —Ç–∏–ø–æ–≤

### 4. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –°—Ç–∞—Ä—ã–π —Ñ–∞–π–ª `models.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ CRUD —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- –í—Å–µ —Å—Ç–∞—Ä—ã–µ API –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## üìö –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Python –ø—Ä–∏–º–µ—Ä
```python
import requests

# –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–µ 10 –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ
response = requests.get("http://localhost:8000/lessons", params={
    "page": 1,
    "page_size": 10,
    "status": "completed",
    "lesson_type": "chinese",
    "order_by": "created_at",
    "order_direction": "desc"
})

data = response.json()
print(f"–ù–∞–π–¥–µ–Ω–æ {data['meta']['total_items']} —É—Ä–æ–∫–æ–≤")

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
from datetime import datetime, timedelta
month_ago = datetime.now() - timedelta(days=30)

response = requests.get("http://localhost:8000/lessons/statistics", params={
    "created_after": month_ago.isoformat()
})

stats = response.json()
print(f"–£—Ä–æ–∫–æ–≤ –∑–∞ –º–µ—Å—è—Ü: {stats['total_lessons']}")
```

### cURL –ø—Ä–∏–º–µ—Ä—ã
```bash
# –°–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
curl "http://localhost:8000/lessons?status=completed&lesson_type=chinese&page=1&page_size=10"

# –ü–æ–∏—Å–∫ —É—Ä–æ–∫–æ–≤
curl "http://localhost:8000/lessons?search=zoom&has_materials=true"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl "http://localhost:8000/lessons/statistics?lesson_type=chinese"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test_new_api.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:

```bash
python3 test_new_api.py
```

–¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–Ω `check_imports.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç–æ–≤:

```bash
python3 check_imports.py
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `API_DOCUMENTATION.md` —Å –Ω–æ–≤—ã–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Swagger UI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–µ API

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞–ø–∫–∏: `models/`, `controllers/`, `filters/`
2. –û–±–Ω–æ–≤–∏—Ç—å `schemas.py`, `crud.py`, `database.py`
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä `routers/lessons/get_list.py`
4. –û–±–Ω–æ–≤–∏—Ç—å `routers/lessons_api.py`

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Eager loading, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. **–ì–∏–±–∫–æ—Å—Ç—å**: –ú–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (–º–æ–¥–µ–ª–∏, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Ñ–∏–ª—å—Ç—Ä—ã)
4. **–£–¥–æ–±—Å—Ç–≤–æ**: –ë–æ–≥–∞—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
5. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: –õ—É—á—à–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 